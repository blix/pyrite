<%!
from pyrite.git.commit import Commit
from pyrite.utils.stringopts import relative_date
data = [Commit.ID, Commit.REFS]
%>
<%namespace name="utils" file="utils.html" />
<%def name="table(project, repo, branch, page=0)">
<div class="table_wrapper">
<table class="standard_table">
    <tr class="data_row">
        <td class="col_header">Date</td>
        <td class="col_header">User</td>
        <td class="col_header">Subject</td>
    </tr>
    <%
        page = page * 100
        if branch:
            gen = Commit.get_commits(repo, None, branch, 100, skip=page,
                                        data=data) 
        else:
            gen = Commit.get_commits(repo, None, None, 100, skip=page,
                                        data=data, all=True) 
    %>
    % for i, c in enumerate(gen):
    <tr class="data_row" parity="${ i % 2 and 'True' or 'False' }">
        <td class="cell">
            ${ relative_date(c.raw[Commit.COMMIT_DATE]) }
        </td>
        <td class="cell">${ c.author_name }</td>
        <td class="cell">
            <a href="${'/%s/commit/%s' % (project,
                        c.id)}">${ c.subject |h }</a>
            % for r in c.refs:
                ${ utils.ref_link(project, r) }&nbsp;
            % endfor
        </td>
    </tr>
    % endfor
</table>
</div>
</%def>
