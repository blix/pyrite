<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<%!
    from pyrite.git.repository import Repo
    from pyrite.git.commit import Commit
    from pyrite.utils.stringopts import humandate, indent
    from pygments import highlight
    from pygments.lexers import get_lexer_by_name
    from pygments.formatters import HtmlFormatter
    __repos = {'default': Repo()}
    lexer = get_lexer_by_name('diff', encoding='utf-8')
    formatter = HtmlFormatter(encoding='utf-8', nobackground=True)
%>
<%
    repo = __repos.get(project, __repos['default'])
    c1 = Commit(v1, obj=repo)
    c2 = Commit(v2, obj=repo)
%>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="/static/common.css" />
    <title>${ repo.description } -
            Pyrite web interface.</title>
    <style type="text/css">
    .commit_info
    {
        margin-top: 20px;
    }
    .base, .update, .divide
    {
        display: inline-block;
        vertical-align: top;
        height: 100%;
    }
    .indent
    {
        padding-left: 5px;
    }
    .heading
    {
        margin-bottom: 10px;
        width: 100%;
        background-color: #66CDAA;
        border: solid 1px black;
    }
    .left_side
    {
        padding-left: 10px;
    }
    ${ formatter.get_style_defs('.highlight') }
    </style>
</head>
<%namespace name="header" file="header.html" />
<%namespace name="rp" file="right_panel.html" />
<%namespace name="ft" file="footer.html" />
<%namespace name="utils" file="utils.html" />
<body>
    ${ header.header(project, repo) }

<table>
    <tr>
        <td class="left_side">
            <div class="commit_info">
                <div class="base">
                    <div class="heading indent">Parent</div>
                    <div class="indent">
                        <a href="$ {'/%s/commit/%s' % (project,v1) }">
                            Subject: ${ c1.subject }
                        </a>
                    </div>
                    <br><br>
                    <div class="indent">
                        ${ c1.author | h}
                        ${ humandate(c1.raw[Commit.AUTHOR_DATE]) }<br>
                    </div>
                    <pre>
                        ${ ''.join(indent(c1.body)) | h }
                    </pre>
                </div>
                <div class="divide"></div>
                <div class="update">
                    <div class="heading indent">Current</div>
                    <div class="indent">
                        <a href="$ {'/%s/commit/%s' % (project,v2) }">
                            Subject: ${ c2.subject }
                        </a>
                    </div>
                    <br><br>
                    <div class="indent">
                        ${ c2.author | h}
                        ${ humandate(c2.raw[Commit.AUTHOR_DATE]) }<br>
                    </div>
                    <pre>
                        ${ ''.join(indent(c2.body)) | h }
                    </pre>
                </div>
            </div>
            <hr>
            ${ highlight(''.join(repo.diff(v1, v2, paths=[f])),
                        lexer, formatter) }
        </td>
        <td class="right_side">
            ${ rp.content(project, repo, None) }
        </td>
    </tr>
</table>
${ ft.footer() }
</body>
</html>
